package com.dinkydetails.telly.db;

import java.util.ArrayList;

import com.dinkydetails.telly.AppConstants;
import com.dinkydetails.telly.model.Contact;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;
import android.util.Log;

public class DatabaseHelper extends SQLiteOpenHelper 
{	
	
	    private SQLiteDatabase db;
	    
	    private Context context;
	
	    public DatabaseHelper(Context context)
	    {
	       super(context, AppConstants.DATABASE_NAME, null, AppConstants.DATABASE_VERSION);
	       
	       this.context = context;
	    }
	 
	    @Override
	    public void onCreate(SQLiteDatabase db) 
	    {
	    	if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"DatabaseHelper onCreate() called");
	    	
	    	createContactsTable(db);      	    		
	       	    
	    }
	  	  
	    public void openDb()
	    {
	    	db = this.getWritableDatabase();
	    }
	    
	    public void closeDb()
	    {
	    	db.close();
	    }
	    
	    private void createContactsTable(SQLiteDatabase db)
	    {
	        String CREATE_CONTACTS_TABLE = "CREATE TABLE IF NOT EXISTS " + AppConstants.TABLE_CONTACTS + "("
	        		+ AppConstants.KEY_ID + " INTEGER PRIMARY KEY,"
	                + AppConstants.KEY_FIRST_NAME + " TEXT," 
	        		+ AppConstants.KEY_LAST_NAME + " TEXT,"
	                + AppConstants.KEY_PH_NO + " TEXT," 
	                + AppConstants.KEY_IMAGE_PATH + " TEXT"+")";
	       
	        if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG," CREATE_APP_TABLE: "+CREATE_CONTACTS_TABLE.toString());
	        
	        db.execSQL(CREATE_CONTACTS_TABLE);
	        
	        

	    }
	 		  
	    @Override
	    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion)
	    {
	        // Drop older table if existed
	        db.execSQL("DROP TABLE IF EXISTS " + AppConstants.TABLE_CONTACTS);
	 
	        // Create tables again
	        onCreate(db);
	    }
	    	    
	    public void clearTableData()
	    {
	    	//if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"clearTableData()");
	    	       
			db.delete(AppConstants.TABLE_CONTACTS, null, null);
			
	    }
	    
	   public String addContact(Contact cObj) 
	    {
	    	//if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"addContact() called First name:"+ cObj.getFirstName());
	    	//if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"addContact() called Last name:"+ cObj.getLastName());
	    	//if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"addContact() called Phone no:"+ cObj.getPhNo());
	    	//if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"addContact() called Image Path:"+ cObj.getImagePath());
	    	     	
	    	ContentValues values = new ContentValues();
             
		    values.put(AppConstants.KEY_FIRST_NAME, cObj.getFirstName() );
		    values.put(AppConstants.KEY_LAST_NAME, cObj.getLastName() );
		    values.put(AppConstants.KEY_PH_NO, cObj.getPhNo());
		    values.put(AppConstants.KEY_IMAGE_PATH, cObj.getImagePath() );
		    		    		       	        	      
		    long rowid = db.insert(AppConstants.TABLE_CONTACTS , null, values);
		    	    		    
		    if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"Created rowid: "+rowid);
	        	    
		    return rowid+"";

	    }
	   
	   public void removeContact(String firstName)
	   {
	    	//if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"removeApp() called");
	    	        	 	    	
	    	db.delete(AppConstants.TABLE_CONTACTS, AppConstants.KEY_FIRST_NAME + " = ?" , new String[] { firstName });
	    	    	    	
	   }
	   
	   public void updateContact(Contact cObj,String firstName)
	    {
	    	if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"updateContact() called");
	    	
	    	ContentValues cv = new ContentValues();
			cv.put(AppConstants.KEY_FIRST_NAME, cObj.getFirstName());
			cv.put(AppConstants.KEY_LAST_NAME, cObj.getLastName());
			cv.put(AppConstants.KEY_PH_NO, cObj.getPhNo());
			cv.put(AppConstants.KEY_IMAGE_PATH, cObj.getImagePath());
									
			db.update(AppConstants.TABLE_CONTACTS,  cv , AppConstants.KEY_FIRST_NAME + " = ?" , new String[] { firstName });
			
	    	
	    }
	   
	   public ArrayList<Contact> getAllContactsInfo() 
	   {	    	
	    	if(AppConstants.DEBUG)Log.v(AppConstants.DEBUG_TAG,"getAllContactsInfo()");
	    	
	    	ArrayList<Contact> alContacts = new ArrayList<Contact>();
	    		    	
	    	String selectQuery = "SELECT * FROM " + AppConstants.TABLE_CONTACTS ;
	    		          
	        Cursor cursor = db.rawQuery(selectQuery, null);	       
	    	       
		       if (cursor.moveToFirst()) 
		       {
		           do
		           {
		        	   Contact dcObj = new Contact();
		        	   alContacts.add(dcObj);
		        	 	        	   
		        	   dcObj.setFirstName(cursor.getString(1));
		        	   dcObj.setLastName(cursor.getString(2));
		        	   dcObj.setPhNo(cursor.getString(3));
		        	   dcObj.setImagePath(cursor.getString(4));
		        	   
    	           } while (cursor.moveToNext());
		       }
	    
		   cursor.close();    
		       
	       return alContacts;
	   }

